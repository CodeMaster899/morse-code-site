<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Morse Code Toolkit</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; color: #333; margin: 0; padding: 0; }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }
    textarea { width: 100%; height: 100px; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
    input[type="text"] { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    button { padding: 10px 20px; margin-right: 10px; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .controls label { margin: 0; }
    .controls input[type="range"] { width: 100%; }
    .practice-result { margin-top: 10px; font-weight: bold; }
    .hidden { display: none; }
    .section { background: #fff; padding: 15px; border-radius: 4px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <div class="container">
    <h1>Morse Code Toolkit</h1>
    <div class="section">
      <h2>Encode Text to Morse</h2>
      <textarea id="textInput" placeholder="Enter text..."></textarea>
      <button onclick="encode()">Encode</button>
      <button onclick="playMorse()">Play Morse</button>
      <textarea id="morseOutput" placeholder="Morse code output..." readonly></textarea>
    </div>

    <div class="section">
      <h2>Decode Morse to Text</h2>
      <textarea id="morseInput" placeholder="Enter Morse code (use . and -; separate words with /)..."></textarea>
      <button onclick="decode()">Decode</button>
      <textarea id="textOutput" placeholder="Decoded text output..." readonly></textarea>
    </div>

    <div class="section">
      <h2>Audio Settings</h2>
      <div class="controls">
        <div style="flex:1">
          <label for="wpm">Speed (WPM): <span id="wpmVal">20</span></label>
          <input type="range" id="wpm" min="5" max="40" value="20" oninput="document.getElementById('wpmVal').textContent=this.value">
        </div>
        <div style="flex:1">
          <label for="freq">Tone Frequency (Hz): <span id="freqVal">600</span></label>
          <input type="range" id="freq" min="200" max="1000" value="600" step="50" oninput="document.getElementById('freqVal').textContent=this.value">
        </div>
        <div style="flex:1">
          <label for="vol">Volume: <span id="volVal">0.5</span></label>
          <input type="range" id="vol" min="0" max="1" value="0.5" step="0.05" oninput="document.getElementById('volVal').textContent=this.value">
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Practice Mode</h2>
      <p>Press "Start Practice" to hear a random letter or word in Morse code. Type what you hear.</p>
      <button onclick="startPractice()">Start Practice</button>
      <div id="practicePrompt" style="margin-top:10px;"></div>
      <input type="text" id="practiceInput" placeholder="Type what you hear..." disabled oninput="checkPractice()">
      <div id="practiceResult" class="practice-result"></div>
    </div>
  </div>

  <script>
    const morseMap = {
      "A": ".-",    "B": "-...",  "C": "-.-.",  "D": "-..",
      "E": ".",     "F": "..-.",  "G": "--.",   "H": "....",
      "I": "..",    "J": ".---",  "K": "-.-",   "L": ".-..",
      "M": "--",    "N": "-.",    "O": "---",   "P": ".--.",
      "Q": "--.-",  "R": ".-.",   "S": "...",   "T": "-",
      "U": "..-",   "V": "...-",  "W": ".--",   "X": "-..-",
      "Y": "-.--",  "Z": "--..",
      "0": "-----", "1": ".----", "2": "..---", "3": "...--",
      "4": "....-", "5": ".....", "6": "-....", "7": "--...",
      "8": "---..", "9": "----.",
      ".": ".-.-.-", ",": "--..--", "?": "..--..", "'": ".----.",
      "!": "-.-.--", "/": "-..-.", "(": "-.--.", ")": "-.--.-",
      "&": ".-...", ":": "---...", ";": "-.-.-.", "=": "-...-",
      "+": ".-.-.", "-": "-....-", "_": "..--.-", "\"": ".-..-.",
      "$": "...-..-", "@": ".--.-.", " ": "/"
    };

    const invMorseMap = {};
    for (const key in morseMap) {
      invMorseMap[morseMap[key]] = key;
    }

    function encode() {
      const text = document.getElementById('textInput').value.toUpperCase();
      let result = [];
      for (let ch of text) {
        if (morseMap[ch]) {
          result.push(morseMap[ch]);
        }
      }
      document.getElementById('morseOutput').value = result.join(' ');
    }

    function decode() {
      const morse = document.getElementById('morseInput').value.trim().split(/\s+/);
      let result = '';
      for (let symbol of morse) {
        if (invMorseMap[symbol]) {
          result += invMorseMap[symbol];
        }
      }
      document.getElementById('textOutput').value = result;
    }

    function playMorse() {
      const morse = document.getElementById('morseOutput').value.trim().split(' ');
      const wpm = parseFloat(document.getElementById('wpm').value);
      const unit = 1200 / wpm; // duration of one dot in ms (PARIS standard)
      const freq = parseFloat(document.getElementById('freq').value);
      const vol  = parseFloat(document.getElementById('vol').value);
      let time = 0;

      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      for (let code of morse) {
        for (let char of code) {
          if (char === '.') {
            beep(ctx, time, unit, freq, vol);
            time += unit + unit; // dot spacing
          } else if (char === '-') {
            beep(ctx, time, unit * 3, freq, vol);
            time += unit * 3 + unit; // dash spacing
          }
        }
        // add gap between codes (3 units) but we already added 1 unit after each dot/dash, so add 2 more
        time += unit * 2;
      }
    }

    function beep(ctx, startTime, duration, freq, vol) {
      const oscillator = ctx.createOscillator();
      const gainNode = ctx.createGain();
      oscillator.frequency.value = freq;
      gainNode.gain.value = vol;
      oscillator.connect(gainNode).connect(ctx.destination);
      oscillator.start(ctx.currentTime + startTime / 1000);
      oscillator.stop(ctx.currentTime + (startTime + duration) / 1000);
    }

    // Practice mode
    const practiceWords = ["SOS","HELP","MORSE","CODE","JAVA","PYTHON","HELLO","WORLD","TEST","AI"];
    let currentPractice = '';
    function startPractice() {
      const allKeys = Object.keys(morseMap).filter(k => k.length === 1 && /[A-Z0-9]/.test(k));
      const chooseWord = Math.random() < 0.5; // half time letter, half time word
      if (chooseWord) {
        currentPractice = practiceWords[Math.floor(Math.random()*practiceWords.length)];
      } else {
        currentPractice = allKeys[Math.floor(Math.random()*allKeys.length)];
      }
      document.getElementById('practicePrompt').textContent = 'Listen...';
      document.getElementById('practiceInput').value = '';
      document.getElementById('practiceInput').disabled = false;
      document.getElementById('practiceResult').textContent = '';
      // set morse output for audio
      document.getElementById('morseOutput').value = currentPractice.split('').map(ch => morseMap[ch]).join(' ');
      playMorse();
      setTimeout(() => {
        document.getElementById('practicePrompt').textContent = 'Type what you heard:';
      }, 1000);
    }

    function checkPractice() {
      const input = document.getElementById('practiceInput').value.trim().toUpperCase();
      if (input.length === currentPractice.length) {
        if (input === currentPractice) {
          document.getElementById('practiceResult').textContent = 'Correct! The answer was ' + currentPractice;
          document.getElementById('practiceResult').style.color = 'green';
        } else {
          document.getElementById('practiceResult').textContent = 'Incorrect. The correct answer was ' + currentPractice;
          document.getElementById('practiceResult').style.color = 'red';
        }
        document.getElementById('practiceInput').disabled = true;
      }
    }
  </script>
</body>
</html>
